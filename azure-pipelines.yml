# Starter pipeline
# Start with a minimal pipeline that you can customize to build and deploy your code.
# Add steps that build, run tests, deploy, and more:

# https://aka.ms/yaml

trigger:
- master

pool:
  vmImage: 'ubuntu-latest'

variables:
  CONTAINER_REGISTRY: pipelinepocs.azurecr.io
  IMAGE_NAME: pipeline_acr/wso2am/wso2am
  TAG: latest

steps:
- task: AzureKeyVault@1
  inputs:
    azureSubscription: 'azuresconn'
    KeyVaultName: 'passwordacr'
    SecretsFilter: '*'
    RunAsPreJob: true

- script: |
    docker pull wso2/wso2am:3.2.0
    docker login pipelinepocs.azurecr.io --username=pipelinepocs --password=SF+RkUmP0ACWlqW8f5OPVClRF4ceq7tC
    docker tag wso2/wso2am:3.2.0 pipelinepocs.azurecr.io/wso2/wso2am:latest
    docker push pipelinepocs.azurecr.io/wso2/wso2am:latest
  displayName: 'Run a one-line script'

